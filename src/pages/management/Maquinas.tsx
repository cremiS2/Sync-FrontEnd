import React, { useState, useEffect } from "react";
import { listMachines, createMachine, updateMachine, deleteMachine } from '../../services/machines';
import { listEmployees } from '../../services/employees';
import { Header, Sidebar } from '../../components/layout';
import { Button, Dialog, DialogTitle, DialogContent, DialogActions } from '@mui/material';
import { Chip, Avatar } from '@mui/material';
import { FaIndustry, FaCog, FaTools, FaPlus, FaEye, FaEdit, FaCheckCircle, FaChartLine } from 'react-icons/fa';
import CUDModal from '../../components/forms/CUDModal';
import type { FormFieldConfig } from '../../components/forms/CUDModal';
import type { Machine, MachineDTO } from '../../types';

const Maquinas: React.FC = () => {
  console.log('Maquinas component is rendering');

  const [sidebarCollapsed, setSidebarCollapsed] = useState(false);
  const [isDarkMode, setIsDarkMode] = useState<boolean>(() => {
    try {
      const saved = localStorage.getItem("theme");
      if (saved) return saved === "dark";
      return window.matchMedia("(prefers-color-scheme: dark)").matches;
    } catch {
      return false;
    }
  });
  const [machines, setMachines] = useState<Machine[]>([]);
  const [employees, setEmployees] = useState<any[]>([]);
  const [selectedMachine, setSelectedMachine] = useState<Machine | null>(null);
  const [showDetailsModal, setShowDetailsModal] = useState(false);
  const [showFormModal, setShowFormModal] = useState(false);
  const [formMode, setFormMode] = useState<'create' | 'edit'>('create');
  const [selectedMachineForEdit, setSelectedMachineForEdit] = useState<Machine | null>(null);

  // Configura√ß√£o dos campos do formul√°rio baseada no MachineDTO do backend
  const machineFields: FormFieldConfig[] = [
    {
      name: 'name',
      label: 'Nome da M√°quina',
      type: 'text',
      required: true,
      placeholder: 'Digite o nome da m√°quina'
    },
    {
      name: 'sector',
      label: 'ID do Setor',
      type: 'number',
      required: true,
      placeholder: 'Ex.: 1'
    },
    {
      name: 'status',
      label: 'Status',
      type: 'select',
      required: true,
      options: [
        { value: 'OPERANDO', label: 'Operando' },
        { value: 'PARADA', label: 'Parada' },
        { value: 'MANUTENCAO', label: 'Manuten√ß√£o' }
      ]
    },
    {
      name: 'oee',
      label: 'OEE (0.0-1.0)',
      type: 'number',
      required: true,
      placeholder: 'Ex.: 0.92'
    },
    {
      name: 'throughput',
      label: 'Vaz√£o (un/h)',
      type: 'number',
      required: true,
      placeholder: 'Ex.: 120'
    },
    {
      name: 'lastMaintenance',
      label: '√öltima Manuten√ß√£o',
      type: 'text',
      required: true,
      placeholder: 'YYYY-MM-DD'
    },
    {
      name: 'photo',
      label: 'URL da Foto (Opcional)',
      type: 'url',
      required: false,
      placeholder: 'Cole a URL da imagem ou deixe vazio para usar √≠cone padr√£o'
    },
    {
      name: 'serieNumber',
      label: 'N√∫mero de S√©rie',
      type: 'number',
      required: true,
      placeholder: 'Ex.: 12345'
    }
  ];

  const loadMachines = async () => {
    try {
      const { data: machinePage } = await listMachines({ pageNumber: 0, pageSize: 100 });
      const mappedMachines = (machinePage.content || []).map((m: any) => ({
        id: m.id,
        name: m.name,
        sector: typeof m.sector === 'object' ? m.sector?.id || '' : m.sector,
        status: m.status?.toLowerCase() || '',
        oee: m.oee,
        throughput: m.throughput,
        lastMaintenance: m.lastMaintenance,
        photo: m.photo,
        serieNumber: m.serieNumber,
        machineModel: 1, // Valor padr√£o para exibi√ß√£o
        // Campos para exibi√ß√£o
        department: typeof m.sector === 'object' ? m.sector?.name || '' : '',
        model: `Modelo ${m.serieNumber}`,
        efficiency: Math.round(m.oee * 100),
        production: Math.round(m.throughput * 8), // Simula√ß√£o de produ√ß√£o di√°ria
        image: m.photo
      }));
      setMachines(mappedMachines);
    } catch (err) {
      console.error('Erro ao carregar m√°quinas:', err);
    }
  };

  const loadEmployees = async () => {
    try {
      const { data: empPage } = await listEmployees({ pageNumber: 0, pageSize: 100 });
      const mappedEmployees = (empPage.content || []).map((e: any) => ({
        id: e.id,
        name: e.name,
        photo: e.photo,
        machineIds: [] // Por enquanto vazio, pode ser implementado depois
      }));
      setEmployees(mappedEmployees);
    } catch (err) {
      console.error('Erro ao carregar funcion√°rios:', err);
    }
  };

  const handleSubmitMachine = async (data: Record<string, any>) => {
    console.log('Dados da m√°quina:', data);
    console.log('Modo:', formMode);
    
    let dto: MachineDTO | Partial<MachineDTO>;
    
    if (formMode === 'create') {
      // Na cria√ß√£o, enviar todos os campos obrigat√≥rios
      dto = {
        name: data.name,
        sector: parseInt(data.sector) || 0,
        status: data.status,
        oee: parseFloat(data.oee) || 0,
        throughput: parseInt(data.throughput) || 0,
        lastMaintenance: data.lastMaintenance,
        // Usar foto padr√£o se n√£o tiver foto
        photo: data.photo && data.photo.trim() !== '' ? data.photo : 'https://via.placeholder.com/150x150/10b981/ffffff?text=üè¢',
        serieNumber: parseInt(data.serieNumber) || 0,
        machineModel: 1 // Valor fixo padr√£o
      };
      console.log('DTO de cria√ß√£o:', dto);
      console.log('Valida√ß√£o dos campos:');
      console.log('- name:', typeof data.name, data.name);
      console.log('- sector:', typeof data.sector, data.sector, '->', parseInt(data.sector));
      console.log('- status:', typeof data.status, data.status);
      console.log('- oee:', typeof data.oee, data.oee, '->', parseFloat(data.oee));
      console.log('- throughput:', typeof data.throughput, data.throughput, '->', parseInt(data.throughput));
      console.log('- lastMaintenance:', typeof data.lastMaintenance, data.lastMaintenance);
      console.log('- photo:', typeof data.photo, data.photo);
      console.log('- serieNumber:', typeof data.serieNumber, data.serieNumber, '->', parseInt(data.serieNumber));
    } else {
      // Na edi√ß√£o, enviar apenas os campos que foram alterados
      dto = {} as Partial<MachineDTO>;
      
      if (data.name) dto.name = data.name;
      if (data.sector && !isNaN(parseInt(data.sector))) dto.sector = parseInt(data.sector);
      if (data.status) dto.status = data.status;
      if (data.oee && !isNaN(parseFloat(data.oee))) dto.oee = parseFloat(data.oee);
      if (data.throughput && !isNaN(parseInt(data.throughput))) dto.throughput = parseInt(data.throughput);
      if (data.lastMaintenance) dto.lastMaintenance = data.lastMaintenance;
      if (data.photo !== undefined) dto.photo = data.photo || undefined;
      if (data.serieNumber && !isNaN(parseInt(data.serieNumber))) dto.serieNumber = parseInt(data.serieNumber);
      
      console.log('DTO de edi√ß√£o:', dto);
      console.log('Campos a serem enviados:', Object.keys(dto));
    }
    
    try {
      if (formMode === 'create') {
        await createMachine(dto as MachineDTO);
        await loadMachines();
      } else {
        if (selectedMachineForEdit) {
          console.log('Editando m√°quina - ID:', selectedMachineForEdit.id);
          console.log('Editando m√°quina - DTO:', dto);
          await updateMachine(selectedMachineForEdit.id, dto as MachineDTO);
          await loadMachines();
        } else {
          throw new Error('M√°quina n√£o encontrada para edi√ß√£o');
        }
      }
      setShowFormModal(false);
    } catch (err: any) {
      console.error('Erro ao salvar m√°quina:', err);
      alert(`Erro ao salvar m√°quina: ${err?.response?.data?.menssagem || err.message}`);
    }
  };

  const handleOpenDetails = (machine: Machine) => {
    setSelectedMachine(machine);
    setShowDetailsModal(true);
  };

  const handleCloseDetails = () => {
    setShowDetailsModal(false);
    setSelectedMachine(null);
  };

  const handleOpenCreate = () => {
    setFormMode('create');
    setSelectedMachineForEdit(null);
    setShowFormModal(true);
  };

  const handleOpenEdit = (machine: Machine) => {
    setFormMode('edit');
    // Pr√©-preencher dados para edi√ß√£o
    const machineData = {
      id: machine.id, // ‚Üê ADICIONAR O ID AQUI
      name: machine.name || '',
      sector: machine.sector?.toString() || '',
      status: machine.status?.toUpperCase() || '',
      oee: machine.oee?.toString() || '',
      throughput: machine.throughput?.toString() || '',
      lastMaintenance: machine.lastMaintenance || '',
      photo: machine.photo || '',
      serieNumber: machine.serieNumber?.toString() || ''
    };
    setSelectedMachineForEdit(machineData as any);
    setShowFormModal(true);
  };

  const handleDeleteMachine = async () => {
    if (selectedMachine) {
      const confirmed = window.confirm(
        `Tem certeza que deseja excluir a m√°quina "${selectedMachine.name}"?\n\n` +
        `Esta a√ß√£o ir√° remover permanentemente:\n` +
        `‚Ä¢ Todos os dados da m√°quina\n` +
        `‚Ä¢ Hist√≥rico de manuten√ß√µes\n` +
        `‚Ä¢ Dados de produ√ß√£o e OEE\n` +
        `‚Ä¢ Aloca√ß√µes de funcion√°rios\n` +
        `‚Ä¢ Todas as informa√ß√µes relacionadas\n\n` +
        `Esta a√ß√£o n√£o pode ser desfeita!`
      );
      
      if (confirmed) {
        try {
          console.log('=== DELETANDO M√ÅQUINA ===');
          console.log('Nome:', selectedMachine.name);
          console.log('ID:', selectedMachine.id);
          console.log('S√©rie:', selectedMachine.serieNumber);
          
          await deleteMachine(selectedMachine.id);
          console.log('M√°quina deletada com sucesso');
          
          await loadMachines();
          setSelectedMachine(null);
          setShowDetailsModal(false);
        } catch (err: any) {
          console.error('Erro ao deletar m√°quina:', err);
          alert(`Erro ao excluir m√°quina: ${err?.response?.data?.menssagem || err.message}`);
        }
      }
    }
  };

  // Carregar dados iniciais
  useEffect(() => {
    loadMachines();
    loadEmployees();
  }, []);

  // Sincronizar com o tema do Header
  useEffect(() => {
    const checkTheme = () => {
      const isDark = document.documentElement.classList.contains('dark');
      setIsDarkMode(isDark);
    };

    // Verificar tema inicial
    checkTheme();

    // Observar mudan√ßas no tema
    const observer = new MutationObserver(checkTheme);
    observer.observe(document.documentElement, {
      attributes: true,
      attributeFilter: ['class']
    });

    // Tamb√©m escutar mudan√ßas no localStorage
    const handleStorageChange = () => {
      checkTheme();
    };
    window.addEventListener('storage', handleStorageChange);

    return () => {
      observer.disconnect();
      window.removeEventListener('storage', handleStorageChange);
    };
  }, []);

  const totalMachines = machines.length;
  const operatingMachines = machines.filter(m => m.status === 'operando').length;
  const maintenanceMachines = machines.filter(m => m.status === 'manutencao').length;

  const averageOEE = machines.length ? Math.round(machines.reduce((sum, m) => sum + (m.oee * 100), 0) / machines.length) : 0;

  const getStatusColor = (status: string) => {
    switch (status.toLowerCase()) {
      case 'operando': return 'success';
      case 'parada': return 'error';
      case 'manutencao': return 'warning';
      default: return 'default';
    }
  };

  const getMachineIcon = (name: string) => {
    if (name.includes('Corte')) return <FaIndustry />;
    if (name.includes('Prensa')) return <FaCog />;
    if (name.includes('Injetora')) return <FaTools />;
    if (name.includes('Montadora')) return <FaIndustry />;
    return <FaIndustry />;
  };

  return (
    <div className="w-screen min-h-screen" style={{ background: 'var(--bg-gradient)' }}>
      <Header />
      <Sidebar 
        isCollapsed={sidebarCollapsed} 
        onToggle={() => setSidebarCollapsed(!sidebarCollapsed)} 
      />
      <main className={`transition-all duration-300 pt-16 ${
        sidebarCollapsed ? 'ml-16' : 'ml-64'
      }`}>
        <div className="p-6 min-h-screen" style={{ background: 'var(--bg-gradient)' }}>
          {/* Monday.com Style Header */}
          <div className={`rounded-2xl shadow-sm border p-8 mb-8 ${
            isDarkMode ? "bg-gray-800 border-gray-700" : "bg-white border-gray-200"
          }`}>
            <div className="flex items-center justify-between">
              <div>
                <h1 className={`text-3xl font-bold mb-2 ${
                  isDarkMode ? "text-white" : "text-gray-900"
                }`}>M√°quinas</h1>
                <p className={`text-base ${
                  isDarkMode ? "text-gray-400" : "text-gray-600"
                }`}>Monitoramento e controle das m√°quinas de produ√ß√£o</p>
              </div>
              <Button
                variant="contained"
                startIcon={<FaPlus />}
                onClick={handleOpenCreate}
                sx={{
                  backgroundColor: 'var(--primary)',
                  color: 'white',
                  fontSize: '0.875rem',
                  textTransform: 'none',
                  py: 2,
                  px: 4,
                  borderRadius: '12px',
                  '&:hover': {
                    backgroundColor: 'var(--primary-dark)',
                  },
                }}
              >
                Adicionar M√°quina
              </Button>
            </div>
          </div>

          {/* KPI Cards Grid */}
          <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8 mb-8">
            <div className={`rounded-2xl shadow-sm border-2 p-8 hover:shadow-lg transition-all duration-300 ${
              isDarkMode ? "bg-gray-800" : "bg-white"
            }`} style={{
              borderColor: isDarkMode ? '#3b82f6' : '#3b82f6'
            }}>
              <div className="flex items-start justify-between mb-6">
                <div className="flex-1">
                  <p className={`text-sm font-semibold mb-3 uppercase tracking-wide ${
                    isDarkMode ? "text-gray-400" : "text-gray-600"
                  }`}>Total de M√°quinas</p>
                  <p className={`text-4xl font-bold mb-3 ${
                    isDarkMode ? "text-white" : "text-gray-900"
                  }`}>{totalMachines}</p>
                  <div className="flex items-center gap-2 text-sm text-green-600 font-medium">
                    <span>Todas operacionais</span>
                  </div>
                </div>
                <div className={`w-16 h-16 rounded-2xl flex items-center justify-center ${
                  isDarkMode ? "bg-blue-900/30" : "bg-blue-100"
                }`}>
                  <FaIndustry className={`text-2xl ${
                    isDarkMode ? "text-blue-400" : "text-blue-600"
                  }`} />
                </div>
              </div>
            </div>

            <div className={`rounded-2xl shadow-sm border-2 p-8 hover:shadow-lg transition-all duration-300 ${
              isDarkMode ? "bg-gray-800" : "bg-white"
            }`} style={{
              borderColor: isDarkMode ? '#10b981' : '#10b981'
            }}>
              <div className="flex items-start justify-between mb-6">
                <div className="flex-1">
                  <p className={`text-sm font-semibold mb-3 uppercase tracking-wide ${
                    isDarkMode ? "text-gray-400" : "text-gray-600"
                  }`}>Em Opera√ß√£o</p>
                  <p className={`text-4xl font-bold mb-3 ${
                    isDarkMode ? "text-white" : "text-gray-900"
                  }`}>{operatingMachines}</p>
                  <div className="flex items-center gap-2 text-sm text-green-600 font-medium">
                    <span>{Math.round((operatingMachines/totalMachines)*100)}% ativas</span>
                  </div>
                </div>
                <div className={`w-16 h-16 rounded-2xl flex items-center justify-center ${
                  isDarkMode ? "bg-green-900/30" : "bg-green-100"
                }`}>
                  <FaCheckCircle className={`text-2xl ${
                    isDarkMode ? "text-green-400" : "text-green-600"
                  }`} />
                </div>
              </div>
            </div>

            <div className={`rounded-2xl shadow-sm border-2 p-8 hover:shadow-lg transition-all duration-300 ${
              isDarkMode ? "bg-gray-800" : "bg-white"
            }`} style={{
              borderColor: isDarkMode ? '#f97316' : '#f97316'
            }}>
              <div className="flex items-start justify-between mb-6">
                <div className="flex-1">
                  <p className={`text-sm font-semibold mb-3 uppercase tracking-wide ${
                    isDarkMode ? "text-gray-400" : "text-gray-600"
                  }`}>Em Manuten√ß√£o</p>
                  <p className={`text-4xl font-bold mb-3 ${
                    isDarkMode ? "text-white" : "text-gray-900"
                  }`}>{maintenanceMachines}</p>
                  <div className="flex items-center gap-2 text-sm text-orange-600 font-medium">
                    <span>Preventiva</span>
                  </div>
                </div>
                <div className={`w-16 h-16 rounded-2xl flex items-center justify-center ${
                  isDarkMode ? "bg-orange-900/30" : "bg-orange-100"
                }`}>
                  <FaTools className={`text-2xl ${
                    isDarkMode ? "text-orange-400" : "text-orange-600"
                  }`} />
                </div>
              </div>
            </div>

            <div className={`rounded-2xl shadow-sm border-2 p-8 hover:shadow-lg transition-all duration-300 ${
              isDarkMode ? "bg-gray-800" : "bg-white"
            }`} style={{
              borderColor: isDarkMode ? '#eab308' : '#eab308'
            }}>
              <div className="flex items-start justify-between mb-6">
                <div className="flex-1">
                  <p className={`text-sm font-semibold mb-3 uppercase tracking-wide ${
                    isDarkMode ? "text-gray-400" : "text-gray-600"
                  }`}>OEE M√©dio</p>
                  <p className={`text-4xl font-bold mb-3 ${
                    isDarkMode ? "text-white" : "text-gray-900"
                  }`}>{averageOEE}%</p>
                  <div className="flex items-center gap-2 text-sm text-green-600 font-medium">
                    <span>+3.2% vs m√™s anterior</span>
                  </div>
                </div>
                <div className={`w-16 h-16 rounded-2xl flex items-center justify-center ${
                  isDarkMode ? "bg-yellow-900/30" : "bg-yellow-100"
                }`}>
                  <FaChartLine className={`text-2xl ${
                    isDarkMode ? "text-yellow-400" : "text-yellow-600"
                  }`} />
                </div>
              </div>
            </div>
          </div>

          {/* Grid de M√°quinas */}
          <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8">
            {machines.map((machine) => {
              const operadores = employees.filter(emp => emp.machineIds && emp.machineIds.includes(machine.id));
              return (
                <div
                  key={machine.id}
                  className={`rounded-2xl shadow-sm border p-8 hover:shadow-lg transition-all duration-300 cursor-pointer ${
                    isDarkMode ? "bg-gray-800 border-gray-700" : "bg-white border-gray-200"
                  }`}
                  onClick={() => handleOpenDetails(machine)}
                >
                  <div className="flex items-start justify-between mb-6">
                    <div className="flex items-center gap-4">
                      <Avatar
                        src={machine.image}
                        className={`w-16 h-16 border-4 shadow-lg ${
                          machine.status === 'Operando' ? 'border-green-400' :
                          machine.status === 'Manuten√ß√£o' ? 'border-yellow-400' :
                          machine.status === 'Parada' ? 'border-red-400' : 'border-gray-300'
                        }`}
                      />
                      <div>
                        <h3 className={`text-xl font-bold mb-2 ${
                          isDarkMode ? "text-white" : "text-gray-900"
                        }`}>{machine.name}</h3>
                        <p className={`text-sm ${
                          isDarkMode ? "text-gray-400" : "text-gray-600"
                        }`}>M√°quina de Produ√ß√£o</p>
                      </div>
                    </div>
                    <Chip 
                      label={machine.status}
                      color={getStatusColor(machine.status) as any}
                      size="small"
                    />
                  </div>

                  <div className="mb-6">
                    <div className="flex flex-wrap gap-2 mb-4">
                      {operadores.length > 0 ? operadores.map(emp => (
                        <Chip key={emp.id} label={emp.name.split(' ')[0]} avatar={<Avatar src={emp.photo} />} size="small" />
                      )) : <span className={`text-xs ${
                        isDarkMode ? "text-gray-400" : "text-gray-600"
                      }`}>Sem operador</span>}
                    </div>
                    
                    <div className="grid grid-cols-2 gap-4">
                      <div className={`text-center p-4 rounded-2xl ${
                        isDarkMode ? "bg-gray-700/50" : "bg-gray-50"
                      }`}>
                        <p className={`text-xs mb-1 ${
                          isDarkMode ? "text-gray-400" : "text-gray-600"
                        }`}>OEE</p>
                        <p className={`text-2xl font-bold ${
                          isDarkMode ? "text-white" : "text-gray-900"
                        }`}>{Math.round(machine.oee * 100)}%</p>
                        <div className="w-full bg-gray-200 rounded-full h-1 mt-2">
                          <div
                            className="bg-gradient-to-r from-[var(--primary)] to-[var(--primary-dark)] h-1 rounded-full transition-all duration-300"
                            style={{ width: `${machine.oee * 100}%` }}
                          ></div>
                        </div>
                      </div>
                      <div className={`text-center p-4 rounded-2xl ${
                        isDarkMode ? "bg-gray-700/50" : "bg-gray-50"
                      }`}>
                        <p className={`text-xs mb-1 ${
                          isDarkMode ? "text-gray-400" : "text-gray-600"
                        }`}>Vaz√£o</p>
                        <p className={`text-2xl font-bold ${
                          isDarkMode ? "text-white" : "text-gray-900"
                        }`}>{machine.throughput}</p>
                        <p className={`text-xs ${
                          isDarkMode ? "text-gray-400" : "text-gray-600"
                        }`}>un/h</p>
                      </div>
                    </div>
                  </div>

                  <div className="flex gap-2">
                    <Button
                      variant="outlined"
                      startIcon={<FaEye />}
                      size="small"
                      onClick={(e) => {
                        e.stopPropagation();
                        handleOpenDetails(machine);
                      }}
                      sx={{
                        color: 'var(--primary)',
                        borderColor: 'var(--primary)',
                        fontSize: '0.875rem',
                        textTransform: 'none',
                        py: 2,
                        borderRadius: '12px',
                        '&:hover': {
                          backgroundColor: 'var(--primary)',
                          color: 'white',
                          borderColor: 'var(--primary)',
                        },
                      }}
                      fullWidth
                    >
                      Ver
                    </Button>
                    <Button
                      variant="outlined"
                      startIcon={<FaEdit />}
                      size="small"
                      onClick={(e) => {
                        e.stopPropagation();
                        handleOpenEdit(machine);
                      }}
                      sx={{
                        color: 'var(--primary)',
                        borderColor: 'var(--primary)',
                        fontSize: '0.875rem',
                        textTransform: 'none',
                        py: 2,
                        borderRadius: '12px',
                        '&:hover': {
                          backgroundColor: 'var(--primary)',
                          color: 'white',
                          borderColor: 'var(--primary)',
                        },
                      }}
                      fullWidth
                    >
                      Editar
                    </Button>
                  </div>
                </div>
              );
            })}
          </div>
        </div>
        </main>

        {/* Modais */}
        <Dialog
          open={showDetailsModal}
          onClose={handleCloseDetails}
          maxWidth="md"
          fullWidth
        >
          {selectedMachine && (
            <>
              <DialogTitle className="bg-gradient-to-r from-[var(--primary)] to-[var(--primary-dark)] text-white">
                <div className="flex items-center gap-3">
                  <div className="w-10 h-10 bg-white/20 rounded-full flex items-center justify-center">
                    <div className="text-white text-lg">
                      {getMachineIcon(selectedMachine.name)}
                    </div>
                  </div>
                  <div>
                    <h2 className="text-xl font-semibold">{selectedMachine.name}</h2>
                    <p className="text-sm opacity-90">Detalhes da M√°quina</p>
                  </div>
                </div>
              </DialogTitle>

              <DialogContent className="p-6">
                <div className="space-y-6">
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div className="space-y-4">
                      <div>
                        <h3 className="text-lg font-semibold text-[var(--primary)] mb-3">Informa√ß√µes B√°sicas</h3>
                        <div className="space-y-3">
                          <div className="flex justify-between">
                            <span className="text-gray-600">Nome:</span>
                            <span className="font-medium">{selectedMachine.name}</span>
                          </div>
                          <div className="flex justify-between">
                            <span className="text-gray-600">Modelo:</span>
                            <span className="font-medium">{selectedMachine.model}</span>
                          </div>
                          <div className="flex justify-between">
                            <span className="text-gray-600">Status:</span>
                            <span className={`px-2 py-1 rounded-full text-xs font-medium ${
                              selectedMachine.status === 'Ativa' 
                                ? 'bg-green-100 text-green-800' 
                                : 'bg-red-100 text-red-800'
                            }`}>
                              {selectedMachine.status}
                            </span>
                          </div>
                          <div className="flex justify-between">
                            <span className="text-gray-600">Departamento:</span>
                            <span className="font-medium">{selectedMachine.department}</span>
                          </div>
                        </div>
                      </div>
                    </div>

                    <div className="space-y-4">
                      <div>
                        <h3 className="text-lg font-semibold text-[var(--primary)] mb-3">M√©tricas</h3>
                        <div className="space-y-3">
                          <div className="flex justify-between">
                            <span className="text-gray-600">OEE:</span>
                            <span className="font-medium">{selectedMachine.oee}%</span>
                          </div>
                          <div className="flex justify-between">
                            <span className="text-gray-600">Efici√™ncia:</span>
                            <span className="font-medium">{selectedMachine.efficiency}%</span>
                          </div>
                          <div className="flex justify-between">
                            <span className="text-gray-600">Produ√ß√£o:</span>
                            <span className="font-medium">{selectedMachine.production} unidades</span>
                          </div>
                          <div className="flex justify-between">
                            <span className="text-gray-600">√öltima Manuten√ß√£o:</span>
                            <span className="font-medium">{selectedMachine.lastMaintenance}</span>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>

                  <div>
                    <h3 className="text-lg font-semibold text-[var(--primary)] mb-3">Hist√≥rico de Manuten√ß√£o</h3>
                    <div className="bg-gray-50 rounded-lg p-4">
                      <div className="space-y-2">
                        <div className="flex justify-between items-center py-2 border-b border-gray-200">
                          <span className="text-sm text-gray-600">Manuten√ß√£o Preventiva</span>
                          <span className="text-sm font-medium">15/01/2024</span>
                        </div>
                        <div className="flex justify-between items-center py-2 border-b border-gray-200">
                          <span className="text-sm text-gray-600">Troca de Filtros</span>
                          <span className="text-sm font-medium">10/01/2024</span>
                        </div>
                        <div className="flex justify-between items-center py-2">
                          <span className="text-sm text-gray-600">Calibra√ß√£o</span>
                          <span className="text-sm font-medium">05/01/2024</span>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </DialogContent>

              <DialogActions className="p-6">
                <div className="flex gap-3 w-full justify-end">
                  <Button
                    variant="outlined"
                    onClick={handleCloseDetails}
                    sx={{
                      color: 'var(--primary)',
                      borderColor: 'var(--primary)',
                      '&:hover': {
                        backgroundColor: 'var(--primary)',
                        color: 'white',
                        borderColor: 'var(--primary)',
                      },
                    }}
                  >
                    Fechar
                  </Button>
                  <Button
                    variant="contained"
                    onClick={() => {
                      handleCloseDetails();
                      handleOpenEdit(selectedMachine);
                    }}
                    sx={{
                      backgroundColor: 'var(--primary)',
                      '&:hover': {
                        backgroundColor: 'var(--primary-dark)',
                      },
                    }}
                  >
                    Editar
                  </Button>
                  <Button
                    variant="contained"
                    onClick={() => {
                      handleCloseDetails();
                      handleDeleteMachine();
                    }}
                    sx={{
                      backgroundColor: '#dc2626',
                      '&:hover': {
                        backgroundColor: '#b91c1c',
                      },
                    }}
                  >
                    Excluir
                  </Button>
                </div>
              </DialogActions>
            </>
          )}
        </Dialog>

        <CUDModal
          open={showFormModal}
          onClose={() => setShowFormModal(false)}
          mode={formMode}
          title={formMode === 'create' ? 'Adicionar Nova M√°quina' : 'Editar M√°quina'}
          fields={machineFields}
          initialData={selectedMachineForEdit || {}}
          onSubmit={handleSubmitMachine}
          entityType="machine"
        />
    </div>
  );
};

export default Maquinas;
